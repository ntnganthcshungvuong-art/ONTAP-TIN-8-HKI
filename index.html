<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√îN T√ÇÃ£P CU√îÃÅI HOÃ£C KYÃÄ I - TIN HOÃ£C 8</title>
<style>
  :root{
    --bg1:#fff1f2;          /* h·ªìng r·∫•t nh·∫°t */
    --bg2:#fff7f8;          /* tr·∫Øng pha h·ªìng */
    --card:rgba(255,255,255,.94);
    --ink:#3f1d2a;          /* ch·ªØ n√¢u h·ªìng ƒë·∫≠m */
    --muted:#6b3a4a;
    --pink:#ec4899;
    --pink-100:#fce7f3;
    --green:#16a34a;
    --red:#dc2626;
    --amber:#f59e0b;
    --border:#fbcfe8;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    color:var(--ink);
    font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:
      radial-gradient(1200px 600px at 15% 0%, #fde2e7 0%, rgba(253,226,231,0) 60%),
      radial-gradient(900px 500px at 90% 10%, #fce7f3 0%, rgba(252,231,243,0) 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
  }
  .container{max-width:980px;margin:32px auto;padding:0 16px}

  h1{
    margin:8px 0 6px;
    font-weight:900;
    letter-spacing:.2px;
    color:#9d174d;
  }
  .sub{color:var(--muted);margin-bottom:12px}

  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 18px;align-items:center}
  .btn{
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 14px;
    background:rgba(252,231,243,.8);
    color:#9d174d;
    cursor:pointer;
    backdrop-filter: blur(6px);
  }
  .btn:hover{filter:brightness(0.99)}
  .btn.primary{
    background:linear-gradient(135deg, #ec4899, #f472b6);
    color:#fff;
    border-color:transparent;
  }
  .btn.warn{background:#fff7ed;color:#9a3412;border:1px solid #fed7aa}

  .card{
    background:var(--card);
    border:1px solid rgba(251,207,232,.9);
    border-radius:18px;
    padding:18px;
    margin:14px 0;
    box-shadow:0 10px 28px rgba(157,23,77,.12);
    backdrop-filter: blur(8px);
  }
  .q-title{font-weight:800;margin-bottom:10px}
  .q-img{
    max-width:100%;
    height:auto;
    display:block;
    margin:10px 0;
    border-radius:14px;
    border:1px solid #fbcfe8;
  }

  .opt{
    display:flex;
    gap:8px;
    align-items:flex-start;
    margin:6px 0;
    padding:10px;
    border-radius:14px;
    transition:.15s;
    border:1px solid transparent;
  }
  .opt:hover{
    background:rgba(252,231,243,.7);
    border-color:rgba(244,114,182,.7);
  }
  .opt img{
    max-width:100%;
    height:auto;
    display:block;
    border-radius:12px;
    border:1px solid #fbcfe8;
  }

  .muted{color:var(--muted)}
  .pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    font-size:13px;
    border-radius:999px;
    padding:4px 10px;
    background:rgba(252,231,243,.9);
    color:#9d174d;
    border:1px solid rgba(244,114,182,.7);
  }
  .score{font-weight:900}
  .good{color:var(--green)}
  .bad{color:var(--red)}
  .warnTxt{color:var(--amber)}

  .error{
    background:#fee2e2;
    border:1px solid #fecaca;
    color:#7f1d1d;
    padding:12px;
    border-radius:14px;
  }
  .tiny{font-size:13px}

  .hint{
    display:none;
    margin-top:10px;
    padding:12px;
    border-radius:16px;
    background:rgba(255,255,255,.9);
    border:1px dashed #fbcfe8;
  }
  .hint.show{display:block}
</style>

</head>
<body>
  <div class="container">
    <h1>√îN T√ÇÃ£P CU√îÃÅI HOÃ£C KYÃÄ I - TIN HOÃ£C</h1>
    <div class="sub">C√≥ x√°o c√¢u/ƒë√°p √°n, ch·∫•m ƒëi·ªÉm. G·ª£i √Ω l√† ki·∫øn th·ª©c c√¥ ƒë·ªçng theo b√†i h·ªçc Tin 8.</div>

    <div class="toolbar">
      <button id="btnRetryNoShuffle" class="btn">üîÅ L√†m l·∫°i (gi·ªØ th·ª© t·ª±)</button>
      <button id="btnRetryShuffle" class="btn">üé≤ L√†m l·∫°i (x√°o c√¢u &amp; ƒë√°p √°n)</button>
      <button id="btnGrade" class="btn primary">‚úÖ Ch·∫•m ƒëi·ªÉm</button>
      <button id="btnClearMarks" class="btn warn">üßπ X√≥a nh√£n ƒë√∫ng/sai</button>
      <span id="score" class="pill">ƒêi·ªÉm: <span class="score">0/0</span></span>
      <span id="status" class="muted tiny"></span>
    </div>

    <div id="quiz"></div>
  </div>

<script>
let ORIGINAL_DATA = null;
let CURRENT_DATA  = null;

const $  = (s, r=document)=>r.querySelector(s);
const $$ = (s, r=document)=>[...r.querySelectorAll(s)];
const clone = o => JSON.parse(JSON.stringify(o));

function escapeHtml(s){
  return String(s ?? '')
    .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
    .replaceAll('"','&quot;').replaceAll("'","&#039;");
}
function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}
function setStatus(msg){ $('#status').textContent = msg || ''; }
function setScore(c,t){ $('#score .score').textContent = `${c}/${t}`; }

async function loadData(){
  try{
    setStatus('ƒêang t·∫£i d·ªØ li·ªáu...');
    const res = await fetch('data/tin8.json?ts=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error(`HTTP ${res.status} khi t·∫£i data/tin8.json`);
    const raw = await res.json();
    if(!raw || !Array.isArray(raw.mcqs)) throw new Error('JSON ph·∫£i c√≥ d·∫°ng { "mcqs": [ ... ] }');
    ORIGINAL_DATA = raw;
    render(ORIGINAL_DATA, false);
    setStatus('ƒê√£ t·∫£i xong.');
  }catch(err){
    console.error(err);
    $('#quiz').innerHTML = `
      <div class="card error">
        <b>L·ªói t·∫£i d·ªØ li·ªáu.</b>
        <div class="tiny">Ki·ªÉm tra <code>data/tin8.json</code> ƒë√∫ng v·ªã tr√≠ v√† JSON h·ª£p l·ªá.</div>
        <div class="tiny">Chi ti·∫øt: ${escapeHtml(err.message)}</div>
      </div>
    `;
    setStatus('L·ªói t·∫£i d·ªØ li·ªáu.');
    setScore(0,0);
  }
}

// options: [{text? , image?}] ; answer: 0-3
function shuffleOptions(q){
  const pairs = q.options.map((opt,i)=>({opt,i}));
  shuffleArray(pairs);
  q.options = pairs.map(p=>p.opt);
  q.answer  = pairs.findIndex(p=>p.i===q.answer);
}

function render(raw, doShuffle){
  const data = clone(raw);
  if(doShuffle){
    shuffleArray(data.mcqs);
    data.mcqs.forEach(shuffleOptions);
  }
  CURRENT_DATA = data;
  buildQuiz(CURRENT_DATA);
  clearMarks();
  setScore(0, CURRENT_DATA.mcqs.length);
  window.scrollTo({top:0, behavior:'smooth'});
}

function buildQuiz(data){
  const root = $('#quiz');
  root.innerHTML = `
    <div class="card">
      <div class="q-title">PH·∫¶N TR·∫ÆC NGHI·ªÜM</div>
      <div class="muted">Ch·ªçn 1 ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u. C√≥ th·ªÉ b·∫•m ‚ÄúG·ª£i √Ω‚Äù ƒë·ªÉ xem ki·∫øn th·ª©c li√™n quan.</div>
    </div>
  `;

  data.mcqs.forEach((q,idx)=>{
    const qid = `q${idx}`;
    const imgHtml = q.img ? `<img class="q-img" src="${escapeHtml(q.img)}" alt="minh h·ªça">` : '';

    const optsHtml = q.options.map((opt,oi)=>{
      const label = String.fromCharCode(65+oi);
      const body = opt.image
        ? `<img src="${escapeHtml(opt.image)}" alt="ƒê√°p √°n ${label}">`
        : `<span>${escapeHtml(opt.text ?? '')}</span>`;
      return `
        <label class="opt">
          <input type="radio" name="${qid}" value="${oi}">
          <span><b>${label}.</b> ${body}</span>
        </label>
      `;
    }).join('');

    const hintText = q.hint || "√în l·∫°i ki·∫øn th·ª©c li√™n quan trong b√†i h·ªçc Tin h·ªçc 8.";

    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.qindex = String(idx);
    card.innerHTML = `
      <div class="q-title">C√¢u ${idx+1}: ${escapeHtml(q.stem)}</div>
      ${imgHtml}
      <div>${optsHtml}</div>

      <div class="toolbar" style="margin-top:10px">
        <button class="btn hint-btn" type="button">üí° G·ª£i √Ω</button>
      </div>
      <div class="hint"><b>Ki·∫øn th·ª©c:</b> ${escapeHtml(hintText)}</div>

      <div class="result tiny muted" style="margin-top:10px"></div>
    `;
    root.appendChild(card);

    $('.hint-btn', card).addEventListener('click', ()=>{
      $('.hint', card).classList.toggle('show');
    });
  });
}

function clearMarks(){
  $$('.card[data-qindex]').forEach(card=>{
    const title = $('.q-title',card);
    const base = title.getAttribute('data-base-html');
    if(base) title.innerHTML = base;
    else title.setAttribute('data-base-html', title.innerHTML);
    $('.result',card).textContent='';
  });
}

function grade(){
  if(!CURRENT_DATA?.mcqs?.length) return;
  clearMarks();

  let correct=0;
  const total=CURRENT_DATA.mcqs.length;

  $$('.card[data-qindex]').forEach(card=>{
    const i = Number(card.dataset.qindex);
    const q = CURRENT_DATA.mcqs[i];

    const title = $('.q-title',card);
    const base = title.getAttribute('data-base-html') || title.innerHTML;

    const picked = card.querySelector(`input[name="q${i}"]:checked`);
    const pickedIndex = picked ? Number(picked.value) : null;
    const ans = Number(q.answer);

    if(pickedIndex===null){
      title.innerHTML = `${base} <span class="warnTxt">‚ö† Ch∆∞a ch·ªçn</span>`;
    }else if(pickedIndex===ans){
      correct++;
      title.innerHTML = `${base} <span class="good">‚úî ƒê√∫ng</span>`;
    }else{
      title.innerHTML = `${base} <span class="bad">‚úò Sai</span>`;
    }

    const correctLetter = String.fromCharCode(65+ans);
    const pickedLetter = pickedIndex===null ? '‚Äî' : String.fromCharCode(65+pickedIndex);
    $('.result',card).innerHTML = `ƒê√°p √°n ƒë√∫ng: <b>${correctLetter}</b> ‚Ä¢ B·∫°n ch·ªçn: <b>${pickedLetter}</b>`;
  });

  setScore(correct,total);
  setStatus(`ƒê√£ ch·∫•m: ${correct}/${total}`);
  window.scrollTo({top:0, behavior:'smooth'});
}

window.addEventListener('DOMContentLoaded', ()=>{
  $('#btnRetryNoShuffle').addEventListener('click', ()=> render(ORIGINAL_DATA,false));
  $('#btnRetryShuffle').addEventListener('click', ()=> render(ORIGINAL_DATA,true));
  $('#btnGrade').addEventListener('click', grade);
  $('#btnClearMarks').addEventListener('click', ()=>{
    clearMarks();
    setScore(0, CURRENT_DATA?.mcqs?.length ?? 0);
    setStatus('ƒê√£ x√≥a nh√£n.');
  });
  loadData();
});
</script>
</body>
</html>
